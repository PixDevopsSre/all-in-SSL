import{e,s as a,r as t,$ as n,f as s,d as r,c as i,g as l,o as c,N as o,h as u,B as p,j as d,i as _,k as g,l as f,m,n as y,b as h,p as w,q as v,t as k,v as b,w as I,x as A,y as x,z as q,a as j}from"./main-DzwaUoFb.js";import{u as S,E as P}from"./index-CgB92oEK.js";import{u as C,a as E,b as z}from"./index-BNb4DSrN.js";import{N as F,a as T,w as U,O as K,H as M,T as O,d as L}from"./business-Ckv_hx4t.js";import{g as N,a as R,u as D,d as V,t as B,b as J}from"./access-D1d2FuYi.js";import{A as $}from"./data-BqkycWmp.js";import{S as H}from"./index-Dhf2Wig3.js";import{T as W}from"./index-DeqXP45Z.js";import{n as G}from"./utils-CRt-4gJj.js";import{B as Q}from"./index-B9Dyybyi.js";const X=s(),Y=e("auth-api-manage-store",(()=>{const{handleError:e}=C(),a=t({name:"",type:"btpanel",config:{url:"",api_key:"",ignore_ssl:"0"}}),s={dns:n("t_3_1745735765112"),host:n("t_0_1746754500246"),plugin:"插件"},r=()=>{a.value={name:"",type:"btpanel",config:{url:"",api_key:"",ignore_ssl:"0"}}};return{apiFormProps:a,accessTypeMap:s,fetchAccessList:async a=>{try{const e=await N(a).fetch();return{list:e.data||[],total:e.count}}catch(t){return e(t),{list:[],total:0}}},addNewAccess:async a=>{try{const{fetch:e,message:t}=R(a);t.value=!0,await e(),r()}catch(t){throw e(t)&&X.error(n("t_8_1745289354902")),t}},updateExistingAccess:async a=>{try{const{fetch:e,message:t}=D(a);t.value=!0,await e(),r()}catch(t){throw e(t)&&X.error(n("t_40_1745227838872")),t}},deleteExistingAccess:async a=>{try{const{fetch:e,message:t}=V({id:a});t.value=!0,await e(),r()}catch(t){throw e(t)&&X.error(n("t_40_1745227838872")),t}},resetApiForm:r}})),Z=r({name:"ApiManageForm",props:{data:{type:Object,default:()=>{}}},setup(e){const{ApiManageForm:a}=ue(e);return()=>i("div",{class:"p-4"},[i(a,{labelPlacement:"top",requireMarkPlacement:"right-hanging"},null)])}});function ee(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!_(e)}const{accessTypeMap:ae,apiFormProps:te,fetchAccessList:ne,deleteExistingAccess:se,addNewAccess:re,updateExistingAccess:ie,resetApiForm:le}=(()=>{const e=Y();return{...e,...a(e)}})(),{handleError:ce}=C(),oe=()=>{const{TableComponent:e,PageComponent:a,loading:t,param:s,fetch:r}=l({config:[{title:n("t_2_1745289353944"),key:"name",width:200,ellipsis:{tooltip:!0}},{title:n("t_1_1746754499371"),key:"type",width:140,render:e=>i(W,{icon:e.type,type:"success"},null)},{title:n("t_2_1746754500270"),key:"type",width:200,render:e=>i(u,null,{default:()=>{var a;return[null==(a=e.access_type)?void 0:a.map((e=>i(o,{key:e,type:"dns"===e?"success":"info",size:"small"},{default:()=>[ae[e]]})))]}})},{title:n("t_7_1745215914189"),key:"create_time",width:180},{title:n("t_0_1745295228865"),key:"update_time",width:180},{title:n("t_8_1745215914610"),key:"actions",width:200,align:"right",fixed:"right",render:e=>{let a,t,s;return i(u,{justify:"end"},{default:()=>[i(p,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>(async e=>{try{const{fetch:a,message:t}=B({id:e.id,type:e.type});t.value=!0,a()}catch(a){ce(a)}})(e)},ee(a=n("t_16_1746676855270"))?a:{default:()=>[a]}),i(p,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>g(e)},ee(t=n("t_11_1745215915429"))?t:{default:()=>[t]}),i(p,{size:"tiny",strong:!0,secondary:!0,type:"error",onClick:()=>f(e.id)},ee(s=n("t_12_1745215914312"))?s:{default:()=>[s]})]})}}],request:ne,watchValue:["p","limit"],storage:"authApiManage",alias:{page:"p",pageSize:"limit"},defaultValue:{p:1,limit:10,search:""}}),{SearchComponent:_}=S({onSearch:e=>{s.value.search=e,r()}}),g=e=>{d({title:n("t_4_1745289354902"),area:500,component:Z,componentProps:{data:e},footer:!0,onUpdateShow:e=>{e||r(),le()}})},f=e=>{E({title:n("t_5_1745289355718"),content:n("t_6_1745289358340"),confirmText:n("t_5_1744870862719"),cancelText:n("t_4_1744870861589"),onPositiveClick:async()=>{await se(e),await r()}})};return c(r),{loading:t,fetch:r,TableComponent:e,PageComponent:a,SearchComponent:_,param:s,openAddForm:()=>{d({title:n("t_0_1745289355714"),area:500,component:Z,footer:!0,onUpdateShow:e=>{e||r(),le()}})}}},ue=e=>{var a;const{confirm:s}=q(),{open:r,close:l}=z({text:n("t_0_1746667592819")}),{useFormInput:o,useFormRadioButton:u,useFormSwitch:p,useFormTextarea:d,useFormCustom:_}=f(),j=(null==(a=e.data)?void 0:a.id)?t({...e.data,config:JSON.parse(e.data.config)}):te,S=t(""),P=t([]),C={name:{required:!0,message:n("t_27_1745289355721"),trigger:"input"},type:{required:!0,message:n("t_28_1745289356040"),trigger:"change"},config:{host:{required:!0,trigger:"input",validator:(e,a,t)=>{if(!O(a)&&!L(a))return t(new Error(n("t_0_1749119980577")));t()}},port:{required:!0,trigger:"input",validator:(e,a,t)=>{if(!M(a.toString()))return t(new Error(n("t_1_1745317313096")));t()}},user:{required:!0,trigger:"input",message:n("t_3_1744164839524")},username:{required:!0,message:n("t_0_1747365600180"),trigger:"input"},password:{trigger:"input",validator:(e,a,t)=>{if(!a){const e={westcn:n("t_1_1747365603108"),ssh:n("t_0_1747711335067")};return t(new Error(e[j.value.type]))}t()}},key:{required:!0,message:n("t_31_1745289355715"),trigger:"input"},url:{required:!0,trigger:"input",validator:(e,a,t)=>{if(!K(a)){const e={btpanel:n("t_2_1745317314362"),btwaf:n("t_0_1747271295174"),safeline:n("t_0_1747300383756")};return t(new Error(e[j.value.type]))}t()}},api_key:{trigger:"input",validator:(e,a,t)=>{if(!a.length){const e={cloudflare:n("t_0_1747042966820"),btpanel:n("t_1_1747042969705"),btwaf:n("t_1_1747300384579"),godaddy:n("t_0_1747984137443"),ns1:"请输入API Key",namecheap:"请输入API Key"};return t(new Error(e[j.value.type]))}t()}},api_secret:{required:!0,message:n("t_1_1747984133312"),trigger:"input"},access_secret:{required:!0,message:n("t_2_1747984134626"),trigger:"input"},api_token:{required:!0,message:n("t_0_1747617113090"),trigger:"input"},secret_access_key:{required:!0,message:"请输入Secret Access Key",trigger:"input"},api_user:{required:!0,message:"请输入API User",trigger:"input"},auth_id:{required:!0,message:"请输入Auth ID",trigger:"input"},auth_password:{required:!0,message:"请输入Auth Password",trigger:"input"},tenant_id:{required:!0,message:"请输入Tenant ID",trigger:"input"},client_id:{required:!0,message:"请输入Client ID",trigger:"input"},client_secret:{required:!0,message:"请输入Client Secret",trigger:"input"},secret_id:{required:!0,message:n("t_6_1745317313383"),trigger:"input"},access_key:{trigger:"input",validator:(e,a,t)=>{if(!a){const e={huawei:n("t_2_1747271295877"),baidu:n("t_3_1747271294475"),volcengine:n("t_3_1747365600828"),qiniu:n("t_3_1747984134586"),doge:n("t_0_1750320239265")};return t(new Error(e[j.value.type]))}t()}},secret_key:{trigger:"input",validator:(e,a,t)=>{if(!a.length){const e={tencentcloud:n("t_2_1747042967277"),huawei:n("t_3_1747042967608"),baidu:n("t_4_1747271294621"),volcengine:n("t_4_1747365600137"),doge:n("t_1_1750320241427")};return t(new Error(e[j.value.type]))}t()}},email:{trigger:"input",validator:(e,a,t)=>{if(!U(a))return t(new Error(n("t_5_1747042965911")));t()}},"config.name":{required:!0,message:n("t_0_1750144125193"),trigger:"change"}}},E=Object.entries($).filter((([e,a])=>!("boolean"==typeof a.notApi&&!a.notApi))).map((([e,a])=>({label:a.name,value:e,access:a.type||[]}))),N=new Map([["btwaf","宝塔WAF-URL"],["btpanel","宝塔面板-URL"],["1panel","1Panel-URL"],["safeline","雷池WAF-URL"]]),R=g((()=>{var a;const t=[o(n("t_2_1745289353944"),"name"),_((()=>i(y,{label:n("t_41_1745289354902"),path:"type"},{default:()=>{var a;return[i(m,{class:"w-full",options:E,renderLabel:V,renderTag:D,disabled:!!(null==(a=e.data)?void 0:a.id),filterable:!0,placeholder:n("t_0_1745833934390"),value:j.value.type,"onUpdate:value":e=>j.value.type=e},{empty:()=>i("span",{class:"text-[1.4rem]"},[n("t_0_1745833934390")])})]}})))];switch(j.value.type){case"ssh":t.push(_((()=>i(I,{cols:24,xGap:4},{default:()=>[i(k,{label:n("t_1_1747711335336"),span:16,path:"config.host"},{default:()=>[i(v,{value:j.value.config.host,"onUpdate:value":e=>j.value.config.host=e,placeholder:n("t_2_1747711337958"),"allow-input":G},null)]}),i(k,{label:n("t_2_1745833931404"),span:8,path:"config.port"},{default:()=>[i(b,{value:j.value.config.port,"onUpdate:value":e=>j.value.config.port=e,showButton:!1},null)]})]}))),o(n("t_44_1745289354583"),"config.user"),u(n("t_45_1745289355714"),"config.mode",[{label:n("t_48_1745289355714"),value:"password"},{label:n("t_1_1746667588689"),value:"key"}]),"password"===(null==(a=j.value.config)?void 0:a.mode)?o(n("t_48_1745289355714"),"config.password",{allowInput:G}):d(n("t_1_1746667588689"),"config.key",{rows:3,placeholder:n("t_0_1747709067998")}));break;case"1panel":case"btpanel":case"btwaf":case"safeline":t.push(o(N.get(j.value.type)||"","config.url",{allowInput:G}),o("safeline"===j.value.type?n("t_1_1747617105179"):n("t_55_1745289355715"),"safeline"===j.value.type?"config.api_token":"config.api_key",{allowInput:G}),p(n("t_3_1746667592270"),"config.ignore_ssl",{checkedValue:"1",uncheckedValue:"0"},{showRequireMark:!1}));break;case"aliyun":t.push(o("AccessKeyId","config.access_key_id",{allowInput:G}),o("AccessKeySecret","config.access_key_secret",{allowInput:G}));break;case"tencentcloud":t.push(o("SecretId","config.secret_id",{allowInput:G}),o("SecretKey","config.secret_key",{allowInput:G}));break;case"huaweicloud":case"baidu":case"volcengine":case"doge":t.push(o("AccessKey","config.access_key",{allowInput:G}),o("SecretKey","config.secret_key",{allowInput:G}));break;case"cloudflare":t.push(o("邮箱","config.email",{allowInput:G}),o("APIKey","config.api_key",{allowInput:G}));break;case"westcn":t.push(o("Username","config.username",{allowInput:G}),o("Password","config.password",{allowInput:G}));break;case"godaddy":t.push(o("API Key","config.api_key",{allowInput:G}),o("API Secret","config.api_secret",{allowInput:G}));break;case"qiniu":t.push(o("AccessKey","config.access_key",{allowInput:G}),o("AccessSecret","config.access_secret",{allowInput:G}));break;case"namecheap":t.push(o("API User","config.api_user",{allowInput:G}),o("API Key","config.api_key",{allowInput:G}));break;case"ns1":case"namesilo":case"bunny":t.push(o("API Key","config.api_key",{allowInput:G}));break;case"cloudns":t.push(o("Auth ID","config.auth_id",{allowInput:G}),o("Auth Password","config.auth_password",{allowInput:G}));break;case"aws":case"jdcloud":t.push(o("Access Key ID","config.access_key_id",{allowInput:G}),o("Secret Access Key","config.secret_access_key",{allowInput:G}));break;case"azure":t.push(o("Tenant ID","config.tenant_id",{allowInput:G}),o("Client ID","config.client_id",{allowInput:G}),o("Client Secret","config.client_secret",{allowInput:G}),o("Environment","config.environment",{allowInput:G,placeholder:"public"}));break;case"namedotcom":t.push(o("Username","config.username",{allowInput:G}),o("API Token","config.api_token",{allowInput:G}));break;case"gcore":t.push(o("API Token","config.api_token",{allowInput:G}));break;case"plugin":t.push(_((()=>i(y,{label:n("t_1_1750144122230"),path:"config.name",showRequireMark:!0},{default:()=>[i(m,{class:"w-full",options:P.value,placeholder:n("t_2_1750144123753"),filterable:!0,renderLabel:B,renderTag:W,value:j.value.config.name,"onUpdate:value":e=>j.value.config.name=e,onUpdateValue:(e,a)=>{j.value.config.name=e,S.value=Q(a.config||{})}},{empty:()=>i("span",{class:"text-[1.4rem]"},[n("t_0_1750210698345")])})]}))),_((()=>{const e=j.value.config,a=e=>{j.value.config.config=e};return i(y,{path:"config.params"},{default:()=>[i(v,{type:"textarea",value:"string"==typeof e.config?e.config:JSON.stringify(e.config,null,2),onUpdateValue:a,placeholder:S.value,rows:4},null)],label:()=>i("div",null,[i(F,null,{default:()=>[h("自定义参数")]}),i(w,null,{default:()=>[S.value],trigger:()=>i("span",{class:"inline-flex ml-2 -mt-1 cursor-pointer text-base rounded-full w-[14px] h-[14px] justify-center items-center  text-orange-600 border border-orange-600"},[h("?")])})])})})))}return t}));A((()=>j.value.type),(e=>{var a;switch(e){case"ssh":j.value.config={host:"",port:22,user:"root",mode:"password",password:""};break;case"1panel":case"btpanel":case"btwaf":j.value.config={url:"",api_key:"",ignore_ssl:"0"};break;case"aliyun":j.value.config={access_key_id:"",access_key_secret:""};break;case"baidu":case"huaweicloud":case"doge":j.value.config={access_key:"",secret_key:""};break;case"cloudflare":j.value.config={email:"",api_key:""};break;case"tencentcloud":j.value.config={secret_id:"",secret_key:""};break;case"godaddy":j.value.config={api_key:"",api_secret:""};break;case"qiniu":j.value.config={access_key:"",access_secret:""};break;case"namecheap":j.value.config={api_user:"",api_key:""};break;case"ns1":case"namesilo":case"bunny":j.value.config={api_key:""};break;case"cloudns":j.value.config={auth_id:"",auth_password:""};break;case"aws":case"jdcloud":j.value.config={access_key_id:"",secret_access_key:""};break;case"azure":j.value.config={tenant_id:"",client_id:"",client_secret:"",environment:""};break;case"namedotcom":j.value.config={username:"",api_token:""};break;case"gcore":j.value.config={api_token:""};break;case"plugin":j.value.config={name:(null==(a=P.value[0])?void 0:a.value)||"",config:""}}}));const D=({option:e})=>i(T,{class:"w-full"},{default:()=>[e.label?V(e):i("span",{class:"text-[1.4rem] text-gray-400"},[n("t_0_1745833934390")])]}),V=e=>i(T,{justify:"space-between",class:"w-[38rem]"},{default:()=>[i(T,{align:"center",size:"small"},{default:()=>[i(H,{icon:`resources-${e.value}`,size:"1.6rem"},null),i(F,null,{default:()=>[e.label]}),e.description&&i("div",{class:"text-[1.2rem] text-gray-500 mt-[0.2rem]"},[e.description])]})]}),B=e=>i(T,{justify:"space-between",class:"w-full"},{default:()=>[i(T,{align:"center",size:"small"},{default:()=>[i(H,{icon:`resources-${e.value}`,size:"1.6rem"},null),i("div",null,[i(F,null,{default:()=>[e.label]}),e.description&&i("div",{class:"text-[1.2rem] text-gray-500 mt-[0.2rem]"},[e.description])])]})]}),W=e=>{const{option:a}=e;return i(T,{class:"w-full"},{default:()=>[(null==a?void 0:a.label)?i(T,{align:"center",size:"small"},{default:()=>[i(H,{icon:`resources-${a.value}`,size:"1.4rem"},null),i(F,null,{default:()=>[a.label]})]}):i("span",{class:"text-[1.4rem] text-gray-400"},[n("t_2_1750210698518")])]})},Q=e=>n("t_3_1750210706775")+JSON.stringify(e||{}),{component:X,fetch:Y}=x({config:R,defaultValue:j,request:async e=>{try{const a={...e,config:JSON.stringify(e.config)};if("id"in e){const{id:e,name:t,config:n}=a;await ie({id:e.toString(),name:t,config:n})}else await re(a)}catch(a){throw ce(new Error(n("t_4_1746667590873")))}},rules:C});return s((async e=>{try{r(),await Y(),le(),e()}catch(a){return ce(a)}finally{l()}})),c((async()=>{var e;try{const{data:a}=await J().fetch();if(a&&Array.isArray(a)){const t=[];a.forEach((e=>{t.push({label:e.name,value:e.name,description:e.actions.map((e=>e.description)).join("、"),pluginName:e.name,config:e.config})})),P.value=t,S.value=Q((null==(e=t[0])?void 0:e.config)||{})}}catch(a){}})),{ApiManageForm:X}};const pe=r({name:"AuthApiManage",setup(){const{TableComponent:e,PageComponent:a,SearchComponent:t,openAddForm:s}=oe(),r=j(["contentPadding","borderColor","headerHeight","iconColorHover"]);return()=>i("div",{class:"h-full flex flex-col",style:r.value},[i("div",{class:"mx-auto max-w-[1600px] w-full p-6"},[i(Q,null,{headerLeft:()=>{let e;return i(p,{type:"primary",size:"large",class:"px-5",onClick:s},"function"==typeof(a=e=n("t_0_1745289355714"))||"[object Object]"===Object.prototype.toString.call(a)&&!_(a)?e:{default:()=>[e]});var a},headerRight:()=>i(t,{placeholder:n("t_0_1745289808449")},null),content:()=>i("div",{class:"rounded-lg"},[i(e,{size:"medium","scroll-x":"1560"},{empty:()=>i(P,{addButtonText:n("t_0_1745289355714"),onAddClick:s},null)})]),footerRight:()=>i("div",{class:"mt-4 flex justify-end"},[i(a,null,null)])})])])}});export{pe as default};
