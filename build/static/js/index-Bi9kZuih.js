import{e,s as t,r as a,$ as s,f as r,d as n,c as i,g as c,h as l,o,N as u,j as p,B as _,k as d,i as g,l as f,m as y,n as m,p as h,q as w,t as k,v,w as b,x as A,y as I,z as x,a as q,b as j}from"./main-l9ONqWM3.js";import{u as P,a as S,b as E}from"./index-CROykHUI.js";import{N as F,a as K,w as C,T as z,H as T,O as U,b as M}from"./business-BHURL4si.js";import{g as L,a as O,u as R,d as D,t as N}from"./access-DAUICydO.js";import{A as B}from"./data-DuVKJAVf.js";import{S as V}from"./index-DBGpolyE.js";import{T as H}from"./index-C6GLd94Y.js";import{n as J}from"./utils-CRt-4gJj.js";import{E as W,S as $}from"./index-Boi7lFs7.js";import{B as G}from"./index-DoEhNl1p.js";import{u as Q}from"./index-DDUoCc5m.js";const X=r(),Y=e("auth-api-manage-store",(()=>{const{handleError:e}=P(),t=a({name:"",type:"btpanel",config:{url:"",api_key:"",ignore_ssl:"0"}}),r={dns:s("t_3_1745735765112"),host:s("t_0_1746754500246")},n=()=>{t.value={name:"",type:"btpanel",config:{url:"",api_key:"",ignore_ssl:"0"}}};return{apiFormProps:t,accessTypeMap:r,fetchAccessList:async t=>{try{const e=await L(t).fetch();return{list:e.data||[],total:e.count}}catch(a){return e(a),{list:[],total:0}}},addNewAccess:async t=>{try{const{fetch:e,message:a}=O(t);a.value=!0,await e(),n()}catch(a){throw e(a)&&X.error(s("t_8_1745289354902")),a}},updateExistingAccess:async t=>{try{const{fetch:e,message:a}=R(t);a.value=!0,await e(),n()}catch(a){throw e(a)&&X.error(s("t_40_1745227838872")),a}},deleteExistingAccess:async t=>{try{const{fetch:e,message:a}=D({id:t});a.value=!0,await e(),n()}catch(a){throw e(a)&&X.error(s("t_40_1745227838872")),a}},resetApiForm:n}})),Z=n({name:"ApiManageForm",props:{data:{type:Object,default:()=>{}}},setup(e){const{ApiManageForm:t}=ue(e);return()=>i("div",{class:"p-4"},[i(t,{labelPlacement:"top",requireMarkPlacement:"right-hanging"},null)])}});function ee(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!g(e)}const{accessTypeMap:te,apiFormProps:ae,fetchAccessList:se,deleteExistingAccess:re,addNewAccess:ne,updateExistingAccess:ie,resetApiForm:ce}=(()=>{const e=Y();return{...e,...t(e)}})(),{handleError:le}=P(),oe=()=>{const{component:e,loading:t,param:a,total:r,fetch:n}=c({config:[{title:s("t_2_1745289353944"),key:"name",width:200,ellipsis:{tooltip:!0}},{title:s("t_1_1746754499371"),key:"type",width:120,render:e=>i(H,{icon:e.type,type:"success"},null)},{title:s("t_2_1746754500270"),key:"type",width:180,render:e=>i(p,null,{default:()=>{var t;return[null==(t=e.access_type)?void 0:t.map((e=>i(u,{key:e,type:"dns"===e?"success":"info",size:"small"},{default:()=>[te[e]]})))]}})},{title:s("t_7_1745215914189"),key:"create_time",width:180},{title:s("t_0_1745295228865"),key:"update_time",width:180},{title:s("t_8_1745215914610"),key:"actions",width:240,align:"right",fixed:"right",render:e=>{let t,a,r;return i(p,{justify:"end"},{default:()=>[i(_,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>(async e=>{try{const{fetch:t,message:a}=N({id:e.id,type:e.type});a.value=!0,t()}catch(t){le(t)}})(e)},ee(t=s("t_16_1746676855270"))?t:{default:()=>[t]}),i(_,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>f(e)},ee(a=s("t_11_1745215915429"))?a:{default:()=>[a]}),i(_,{size:"tiny",strong:!0,secondary:!0,type:"error",onClick:()=>y(e.id)},ee(r=s("t_12_1745215914312"))?r:{default:()=>[r]})]})}}],request:se,defaultValue:{p:1,limit:10,search:""},watchValue:["p","limit"]}),{component:g}=l({param:a,total:r,alias:{page:"p",pageSize:"limit"}}),f=e=>{d({title:s("t_4_1745289354902"),area:500,component:Z,componentProps:{data:e},footer:!0,onUpdateShow:e=>{e||n(),ce()}})},y=e=>{S({title:s("t_5_1745289355718"),content:s("t_6_1745289358340"),confirmText:s("t_5_1744870862719"),cancelText:s("t_4_1744870861589"),onPositiveClick:async()=>{await re(e),await n()}})};return o(n),{loading:t,fetch:n,ApiTable:e,ApiTablePage:g,param:a,total:r,openAddForm:()=>{d({title:s("t_0_1745289355714"),area:500,component:Z,footer:!0,onUpdateShow:e=>{e||n(),ce()}})}}},ue=e=>{var t;const{confirm:r}=x(),{open:n,close:c}=E({text:s("t_0_1746667592819")}),{useFormInput:l,useFormRadioButton:o,useFormSwitch:p,useFormTextarea:_,useFormCustom:d}=y(),g=(null==(t=e.data)?void 0:t.id)?a({...e.data,config:JSON.parse(e.data.config)}):ae,q={name:{required:!0,message:s("t_27_1745289355721"),trigger:"input"},type:{required:!0,message:s("t_28_1745289356040"),trigger:"change"},config:{host:{required:!0,trigger:"input",validator:(e,t,a)=>{if(!U(t)&&!M(t))return a(new Error(s("服务器IP地址或域名格式错误")));a()}},port:{required:!0,trigger:"input",validator:(e,t,a)=>{if(!T(t.toString()))return a(new Error(s("t_1_1745317313096")));a()}},user:{required:!0,trigger:"input",message:s("t_3_1744164839524")},username:{required:!0,message:s("t_0_1747365600180"),trigger:"input"},password:{trigger:"input",validator:(e,t,a)=>{if(!t){const e={westcn:s("t_1_1747365603108"),ssh:s("t_0_1747711335067")};return a(new Error(e[g.value.type]))}a()}},key:{required:!0,message:s("t_31_1745289355715"),trigger:"input"},url:{required:!0,trigger:"input",validator:(e,t,a)=>{if(!z(t)){const e={btpanel:s("t_2_1745317314362"),btwaf:s("t_0_1747271295174"),safeline:s("t_0_1747300383756")};return a(new Error(e[g.value.type]))}a()}},api_key:{trigger:"input",validator:(e,t,a)=>{if(!t.length){const e={cloudflare:s("t_0_1747042966820"),btpanel:s("t_1_1747042969705"),btwaf:s("t_1_1747300384579"),godaddy:s("t_0_1747984137443"),ns1:"请输入API Key",namecheap:"请输入API Key"};return a(new Error(e[g.value.type]))}a()}},api_secret:{required:!0,message:s("t_1_1747984133312"),trigger:"input"},access_secret:{required:!0,message:s("t_2_1747984134626"),trigger:"input"},api_token:{required:!0,message:s("t_0_1747617113090"),trigger:"input"},access_key_id:{required:!0,message:s("t_4_1745317314054"),trigger:"input"},access_key_secret:{required:!0,message:s("t_5_1745317315285"),trigger:"input"},secret_access_key:{required:!0,message:"请输入Secret Access Key",trigger:"input"},api_user:{required:!0,message:"请输入API User",trigger:"input"},auth_id:{required:!0,message:"请输入Auth ID",trigger:"input"},auth_password:{required:!0,message:"请输入Auth Password",trigger:"input"},tenant_id:{required:!0,message:"请输入Tenant ID",trigger:"input"},client_id:{required:!0,message:"请输入Client ID",trigger:"input"},client_secret:{required:!0,message:"请输入Client Secret",trigger:"input"},secret_id:{required:!0,message:s("t_6_1745317313383"),trigger:"input"},access_key:{trigger:"input",validator:(e,t,a)=>{if(!t){const e={huawei:s("t_2_1747271295877"),baidu:s("t_3_1747271294475"),volcengine:s("t_3_1747365600828"),qiniu:s("t_3_1747984134586")};return a(new Error(e[g.value.type]))}a()}},secret_key:{trigger:"input",validator:(e,t,a)=>{if(!t.length){const e={tencentcloud:s("t_2_1747042967277"),huawei:s("t_3_1747042967608"),baidu:s("t_4_1747271294621"),volcengine:s("t_4_1747365600137")};return a(new Error(e[g.value.type]))}a()}},email:{trigger:"input",validator:(e,t,a)=>{if(!C(t))return a(new Error(s("t_5_1747042965911")));a()}}}},j=Object.entries(B).filter((([e,t])=>!("boolean"==typeof t.notApi&&!t.notApi))).map((([e,t])=>({label:t.name,value:e,access:t.type||[]}))),P=new Map([["btwaf","宝塔WAF-URL"],["btpanel","宝塔面板-URL"],["1panel","1Panel-URL"],["safeline","雷池WAF-URL"]]),S=f((()=>{var t;const a=[l(s("t_2_1745289353944"),"name"),d((()=>i(h,{label:s("t_41_1745289354902"),path:"type"},{default:()=>{var t;return[i(m,{class:"w-full",options:j,renderLabel:O,renderTag:L,disabled:!!(null==(t=e.data)?void 0:t.id),filterable:!0,placeholder:s("t_0_1745833934390"),value:g.value.type,"onUpdate:value":e=>g.value.type=e},{empty:()=>i("span",{class:"text-[1.4rem]"},[s("t_0_1745833934390")])})]}})))];switch(g.value.type){case"ssh":a.push(d((()=>i(b,{cols:24,xGap:4},{default:()=>[i(w,{label:s("t_1_1747711335336"),span:16,path:"config.host"},{default:()=>[i(k,{value:g.value.config.host,"onUpdate:value":e=>g.value.config.host=e,placeholder:s("t_2_1747711337958"),"allow-input":J},null)]}),i(w,{label:s("t_2_1745833931404"),span:8,path:"config.port"},{default:()=>[i(v,{value:g.value.config.port,"onUpdate:value":e=>g.value.config.port=e,showButton:!1},null)]})]}))),l(s("t_44_1745289354583"),"config.user"),o(s("t_45_1745289355714"),"config.mode",[{label:s("t_48_1745289355714"),value:"password"},{label:s("t_1_1746667588689"),value:"key"}]),"password"===(null==(t=g.value.config)?void 0:t.mode)?l(s("t_48_1745289355714"),"config.password",{allowInput:J}):_(s("t_1_1746667588689"),"config.key",{rows:3,placeholder:s("t_0_1747709067998")}));break;case"1panel":case"btpanel":case"btwaf":case"safeline":a.push(l(P.get(g.value.type)||"","config.url",{allowInput:J}),l("safeline"===g.value.type?s("t_1_1747617105179"):s("t_55_1745289355715"),"safeline"===g.value.type?"config.api_token":"config.api_key",{allowInput:J}),p(s("t_3_1746667592270"),"config.ignore_ssl",{checkedValue:"1",uncheckedValue:"0"},{showRequireMark:!1}));break;case"aliyun":a.push(l("AccessKeyId","config.access_key_id",{allowInput:J}),l("AccessKeySecret","config.access_key_secret",{allowInput:J}));break;case"tencentcloud":a.push(l("SecretId","config.secret_id",{allowInput:J}),l("SecretKey","config.secret_key",{allowInput:J}));break;case"huaweicloud":case"baidu":case"volcengine":a.push(l("AccessKey","config.access_key",{allowInput:J}),l("SecretKey","config.secret_key",{allowInput:J}));break;case"cloudflare":a.push(l("邮箱","config.email",{allowInput:J}),l("APIKey","config.api_key",{allowInput:J}));break;case"westcn":a.push(l("Username","config.username",{allowInput:J}),l("Password","config.password",{allowInput:J}));break;case"godaddy":a.push(l("API Key","config.api_key",{allowInput:J}),l("API Secret","config.api_secret",{allowInput:J}));break;case"qiniu":a.push(l("AccessKey","config.access_key",{allowInput:J}),l("AccessSecret","config.access_secret",{allowInput:J}));break;case"namecheap":a.push(l("API User","config.api_user",{allowInput:J}),l("API Key","config.api_key",{allowInput:J}));break;case"ns1":a.push(l("API Key","config.api_key",{allowInput:J}));break;case"cloudns":a.push(l("Auth ID","config.auth_id",{allowInput:J}),l("Auth Password","config.auth_password",{allowInput:J}));break;case"aws":a.push(l("Access Key ID","config.access_key_id",{allowInput:J}),l("Secret Access Key","config.secret_access_key",{allowInput:J}));break;case"azure":a.push(l("Tenant ID","config.tenant_id",{allowInput:J}),l("Client ID","config.client_id",{allowInput:J}),l("Client Secret","config.client_secret",{allowInput:J}),l("Environment","config.environment",{allowInput:J,placeholder:"public"}))}return a}));A((()=>g.value.type),(e=>{switch(e){case"ssh":g.value.config={host:"",port:22,user:"root",mode:"password",password:""};break;case"1panel":case"btpanel":case"btwaf":g.value.config={url:"",api_key:"",ignore_ssl:"0"};break;case"aliyun":g.value.config={access_key_id:"",access_key_secret:""};break;case"baidu":case"huaweicloud":g.value.config={access_key:"",secret_key:""};break;case"cloudflare":g.value.config={email:"",api_key:""};break;case"tencentcloud":g.value.config={secret_id:"",secret_key:""};break;case"godaddy":g.value.config={api_key:"",api_secret:""};break;case"qiniu":g.value.config={access_key:"",access_secret:""};break;case"namecheap":g.value.config={api_user:"",api_key:""};break;case"ns1":g.value.config={api_key:""};break;case"cloudns":g.value.config={auth_id:"",auth_password:""};break;case"aws":g.value.config={access_key_id:"",secret_access_key:""};break;case"azure":g.value.config={tenant_id:"",client_id:"",client_secret:"",environment:""}}}));const L=({option:e})=>i(F,{class:"w-full"},{default:()=>[e.label?O(e):i("span",{class:"text-[1.4rem] text-gray-400"},[s("t_0_1745833934390")])]}),O=e=>i(F,{justify:"space-between",class:"w-[38rem]"},{default:()=>[i(F,{align:"center",size:"small"},{default:()=>[i(V,{icon:`resources-${e.value}`,size:"1.6rem"},null),i(K,null,{default:()=>[e.label]})]}),i(F,{class:"pr-[1rem]"},{default:()=>[e.access&&e.access.map((e=>i(u,{type:"dns"===e?"success":"info",size:"small",key:e},{default:()=>[te[e]]})))]})]}),{component:R,fetch:D}=I({config:S,defaultValue:g,request:async(e,t)=>{try{const t={...e,config:JSON.stringify(e.config)};if("id"in e){const{id:e,name:a,config:s}=t;await ie({id:e.toString(),name:a,config:s})}else await ne(t)}catch(a){throw le(new Error(s("t_4_1746667590873")))}},rules:q});return r((async e=>{try{n(),await D(),ce(),e()}catch(t){return le(t)}finally{c()}})),{ApiManageForm:R}};const pe=n({name:"AuthApiManage",setup(){const{ApiTable:e,ApiTablePage:t,param:a,fetch:r,total:n,openAddForm:c}=oe(),l=q(["contentPadding","borderColor","headerHeight","iconColorHover"]);return()=>i("div",{class:"h-full flex flex-col",style:l.value},[i("div",{class:"mx-auto max-w-[1600px] w-full p-6"},[i(G,null,{headerLeft:()=>{let e;return i(_,{type:"primary",size:"large",class:"px-5",onClick:c},"function"==typeof(t=e=s("t_0_1745289355714"))||"[object Object]"===Object.prototype.toString.call(t)&&!g(t)?e:{default:()=>[e]});var t},headerRight:()=>i(k,{value:a.value.search,"onUpdate:value":e=>a.value.search=e,onKeydown:e=>{"Enter"===e.key&&r()},onClear:()=>Q((()=>r()),100),placeholder:s("t_0_1745289808449"),clearable:!0,size:"large",class:"min-w-[300px]"},{suffix:()=>i("div",{class:"flex items-center cursor-pointer",onClick:r},[i($,{class:"text-[var(--text-color-3)] w-[1.6rem] font-bold"},null)])}),content:()=>i("div",{class:"rounded-lg"},[i(e,{size:"medium"},{empty:()=>i(W,{addButtonText:s("t_0_1745289355714"),onAddClick:c},null)})]),footerRight:()=>i("div",{class:"mt-4 flex justify-end"},[i(t,null,{prefix:()=>i("span",null,[s("t_15_1745227839354"),j(" "),n.value,j(" "),s("t_16_1745227838930")])})])})])])}});export{pe as default};
