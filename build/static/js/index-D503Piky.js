import{a6 as t,a7 as e,r as a,Z as r,$ as o,d as i,c as n,Y as s,u as l,ag as d,ah as c,B as u,aD as m,aj as p,ak as _,i as y,n as f,al as h,aq as g,ar as v,a2 as w,aV as x,a as M,b,ad as j}from"./main-TC3Bu45J.js";import{c as k,u as F,a as E,b as C}from"./index-jviZh_iP.js";import{b as q}from"./business-CSi1hkxo.js";import{N as S}from"./index-BqQRKdJ8.js";import{T}from"./index-DF0RwvD-.js";import{B as z}from"./index-D0djR_cB.js";import{E as A,S as P}from"./index-DXyQC-X-.js";import"./index-OvFH652L.js";import"./useStore-BUVQMv4E.js";import"./index-C9x9Ia4N.js";import"./index-Cdsjg_sg.js";import"./setting-BqHdEYrN.js";import"./access-CVoV-9UZ.js";import"./data-CXwlriQE.js";const{handleError:B}=F(),N=r(),O=t("monitor-store",(()=>{const t=a({id:0,name:"",domain:"",cycle:1,report_type:""}),e=async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/add_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return B(e)&&N.error(o("t_7_1745289355714")),!1}},r=async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/upd_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return B(e)&&N.error(o("t_23_1745289355716")),!1}};return{monitorForm:t,fetchMonitorList:async t=>{try{const{data:e,count:a}=await(t=>k("/v1/siteMonitor/get_list",t))(t).fetch();return{list:e||[],total:a}}catch(e){return B(e),{list:[],total:0}}},addNewMonitor:e,updateExistingMonitor:r,deleteExistingMonitor:async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/del_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return B(e)&&N.error(o("t_40_1745227838872")),!1}},setMonitorStatus:async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/set_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return B(e)&&N.error(o("t_24_1745289355715")),!1}},resetMonitorForm:()=>{t.value={id:0,name:"",domain:"",cycle:1,report_type:""}},updateMonitorForm:(e=t.value)=>{const{id:a,name:r,domain:o,cycle:i,report_type:n}=e||t.value;t.value={id:a,name:r,domain:o,cycle:i,report_type:n}},submitForm:async()=>{const{id:a,...o}=t.value;return a?r({id:a,...o}):e(o)}}})),U=i({name:"MonitorForm",props:{isEdit:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},setup(t){const{component:e}=G(t.data);return()=>n(e,{labelPlacement:"top"},null)}});function V(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!y(t)}const{fetchMonitorList:D,deleteExistingMonitor:L,setMonitorStatus:H,monitorForm:I,addNewMonitor:R,updateExistingMonitor:$,resetMonitorForm:K,updateMonitorForm:Y}=(()=>{const t=O();return{...t,...e(t)}})(),{handleError:Z}=F(),G=(t=null)=>{const{useFormInput:e,useFormCustom:a,useFormInputNumber:r}=h(),{open:o,close:i}=C({text:"正在提交信息，请稍后..."}),{confirm:s}=v(),l=f((()=>[e("名称","name"),e("域名","domain"),r("周期(分钟)","cycle",{class:"w-full"}),a((()=>n(S,{path:"report_type",isAddMode:!0,value:I.value.report_type,valueType:"type","onUpdate:value":t=>{I.value.report_type=t.value}},null)))])),d={name:{required:!0,message:"请输入名称",trigger:"input"},domain:{required:!0,message:"请输入正确的域名",trigger:"input",validator:(t,e,a)=>{q(e)?a():a(new Error("请输入正确的域名"))}},cycle:{required:!0,message:"请输入周期",trigger:"input",type:"number",min:1,max:365},report_type:{required:!0,message:"请选择消息通知类型",trigger:"change"}},{component:c,fetch:u}=g({config:l,defaultValue:I,request:async e=>{try{if(t)await $({...e,id:t.id});else{const{id:t,...a}=e;await R(a)}}catch(a){Z(a).default("添加失败")}},rules:d});return s((async t=>{try{o(),await u(),t()}catch(e){return Z(e)}finally{i()}})),w((()=>{Y(t)})),x(K),{component:c}};const J=i({name:"MonitorManage",setup(){const{MonitorTable:t,MonitorTablePage:e,param:a,fetch:r,data:i,openAddForm:f,isDetectionAddMonitor:h}=(()=>{const t=s(),e=l(),{component:a,loading:r,param:i,data:y,total:f,fetch:h}=d({config:[{title:o("t_13_1745289354528"),key:"name",width:150},{title:o("t_17_1745227838561"),key:"site_domain",width:180,render:t=>n(u,{tag:"a",text:!0,type:"primary",href:`https://${t.site_domain}`,target:"_blank"},{default:()=>[t.site_domain]})},{title:o("t_14_1745289354902"),key:"cert_domain",width:180,render:t=>t.cert_domain||"-"},{title:o("t_15_1745289355714"),key:"ca",width:180},{title:o("t_16_1745289354902"),key:"state",width:100},{title:o("t_17_1745289355715"),key:"end_time",width:150,render:t=>t.end_time+"("+t.end_day+")"},{title:o("t_18_1745289354598"),key:"report_type",width:150,render:t=>n(T,{icon:t.report_type},null)},{title:o("t_4_1745215914951"),key:"active",width:100,render:t=>n(m,{value:1===t.active,onUpdateValue:()=>M(t)},null)},{title:o("t_19_1745289354676"),key:"update_time",width:150,render:t=>t.update_time||"-"},{title:o("t_7_1745215914189"),key:"create_time",width:150},{title:o("t_8_1745215914610"),key:"actions",width:150,fixed:"right",align:"right",render:t=>{let e,a;return n(p,{justify:"end"},{default:()=>[n(u,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>w(t)},V(e=o("t_11_1745215915429"))?e:{default:()=>[e]}),n(u,{size:"tiny",strong:!0,secondary:!0,type:"error",onClick:()=>x(t)},V(a=o("t_12_1745215914312"))?a:{default:()=>[a]})]})}}],request:D,defaultValue:{p:1,limit:10,search:""},watchValue:["p","limit"]}),{component:g}=c({param:i,total:f,alias:{page:"p",pageSize:"limit"}}),v=()=>{_({title:o("t_11_1745289354516"),area:500,component:U,footer:!0,onUpdateShow(t){t||h()}})},w=t=>{_({title:o("t_20_1745289354598"),area:500,component:U,componentProps:{isEdit:t.id,data:t},footer:!0,onUpdateShow(t){t||h()}})},x=t=>{E({title:o("t_0_1745294710530"),content:o("t_22_1745289359036"),confirmText:o("t_5_1744870862719"),cancelText:o("t_4_1744870861589"),onPositiveClick:async()=>{await L(t),h()}})},M=async t=>{await H({id:t.id,active:Number(t.active)?0:1}),h()};return{loading:r,fetch:h,MonitorTable:a,MonitorTablePage:g,isDetectionAddMonitor:()=>{const{type:a}=t.query;(null==a?void 0:a.includes("create"))&&(v(),e.push({query:{}}))},param:i,data:y,openAddForm:v}})(),g=M(["contentPadding","borderColor","headerHeight","iconColorHover"]);return w((()=>{r(),h()})),()=>n("div",{class:"h-full flex flex-col",style:g.value},[n("div",{class:"mx-auto max-w-[1600px] w-full p-6"},[n(z,null,{headerLeft:()=>{let t;return n(u,{type:"primary",size:"large",class:"px-5",onClick:f},"function"==typeof(e=t=o("t_11_1745289354516"))||"[object Object]"===Object.prototype.toString.call(e)&&!y(e)?t:{default:()=>[t]});var e},headerRight:()=>n(j,{value:a.value.search,"onUpdate:value":t=>a.value.search=t,onKeydown:t=>{"Enter"===t.key&&r()},onClear:()=>r(),placeholder:o("t_12_1745289356974"),clearable:!0,size:"large",class:"min-w-[300px]"},{suffix:()=>n("div",{class:"flex items-center",onClick:r},[n(P,{class:"text-[var(--text-color-3)] w-[1.6rem] cursor-pointer font-bold"},null)])}),content:()=>n("div",{class:"rounded-lg"},[n(t,{size:"medium"},{empty:()=>n(A,{addButtonText:o("t_11_1745289354516"),onAddClick:f},null)})]),footerRight:()=>n("div",{class:"mt-4 flex justify-end"},[n(e,null,{prefix:()=>n("span",null,[o("t_15_1745227839354"),b(" "),i.value.total,b(" "),o("t_16_1745227838930")])})])})])])}});export{J as default};
