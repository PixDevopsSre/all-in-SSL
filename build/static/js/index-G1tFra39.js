import{e as t,s as e,r,f as a,$ as o,d as i,c as n,a4 as s,u as l,g as c,h as d,B as u,a5 as m,j as p,k as _,i as y,l as f,m as h,y as g,z as v,o as w,aG as x,a as M,b,t as j}from"./main-JC8aq1By.js";import{c as k,u as F,a as E,b as C}from"./index-CCRs72lf.js";import{b as P,O as q,H as S}from"./business-0Klrz1zP.js";import{N as T}from"./index-BJg_rAQq.js";import{T as z}from"./index-C3gGf55t.js";import{B as A}from"./index-DEff3yds.js";import{E as I,S as N}from"./index-CmlwJ1kX.js";import"./index-0z5TG9kl.js";import"./useStore-GjfYXPWE.js";import"./index-BlmFsbAg.js";import"./index-Cfd72zNl.js";import"./setting-DMkiJqCd.js";import"./access-CGnP5Z8L.js";import"./data-7FrDFtiI.js";const{handleError:O}=F(),U=a(),B=t("monitor-store",(()=>{const t=r({id:0,name:"",domain:"",cycle:1,report_type:""}),e=async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/add_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return O(e)&&U.error(o("t_7_1745289355714")),!1}},a=async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/upd_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return O(e)&&U.error(o("t_23_1745289355716")),!1}};return{monitorForm:t,fetchMonitorList:async t=>{try{const{data:e,count:r}=await(t=>k("/v1/siteMonitor/get_list",t))(t).fetch();return{list:e||[],total:r}}catch(e){return O(e),{list:[],total:0}}},addNewMonitor:e,updateExistingMonitor:a,deleteExistingMonitor:async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/del_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return O(e)&&U.error(o("t_40_1745227838872")),!1}},setMonitorStatus:async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/set_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return O(e)&&U.error(o("t_24_1745289355715")),!1}},resetMonitorForm:()=>{t.value={id:0,name:"",domain:"",cycle:1,report_type:""}},updateMonitorForm:(e=t.value)=>{const{id:r,name:a,domain:o,cycle:i,report_type:n}=e||t.value;t.value={id:r,name:a,domain:o,cycle:i,report_type:n}},submitForm:async()=>{const{id:r,...o}=t.value;return r?a({id:r,...o}):e(o)}}})),V=i({name:"MonitorForm",props:{isEdit:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},setup(t){const{component:e}=X(t.data);return()=>n(e,{labelPlacement:"top"},null)}});function H(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!y(t)}const{fetchMonitorList:L,deleteExistingMonitor:D,setMonitorStatus:G,monitorForm:R,addNewMonitor:$,updateExistingMonitor:K,resetMonitorForm:J,updateMonitorForm:Q}=(()=>{const t=B();return{...t,...e(t)}})(),{handleError:W}=F(),X=(t=null)=>{const{useFormInput:e,useFormCustom:r,useFormInputNumber:a}=h(),{open:o,close:i}=C({text:"正在提交信息，请稍后..."}),{confirm:s}=v(),l=f((()=>[e("名称","name"),e("域名/IP地址","domain"),a("周期(分钟)","cycle",{class:"w-full"}),r((()=>n(T,{path:"report_type",isAddMode:!0,value:R.value.report_type,valueType:"type","onUpdate:value":t=>{R.value.report_type=t.value}},null)))])),c={name:{required:!0,message:"请输入名称",trigger:"input"},domain:{required:!0,message:"请输入正确的域名或IP地址",trigger:"input",validator:(t,e,r)=>{(t=>{if(!t)return!1;const e=t.split(":");if(1===e.length)return P(t)||q(t);if(2===e.length){const[t,r]=e;return!(!t||!r)&&(P(t)||q(t))&&S(r)}return!1})(e)?r():r(new Error("请输入正确的域名或IP地址（支持域名:端口或IP:端口格式）"))}},cycle:{required:!0,message:"请输入周期",trigger:"input",type:"number",min:1,max:365},report_type:{required:!0,message:"请选择消息通知类型",trigger:"change"}},{component:d,fetch:u}=g({config:l,defaultValue:R,request:async e=>{try{if(t)await K({...e,id:t.id});else{const{id:t,...r}=e;await $(r)}}catch(r){W(r).default("添加失败")}},rules:c});return s((async t=>{try{o(),await u(),t()}catch(e){return W(e)}finally{i()}})),w((()=>{Q(t)})),x(J),{component:d}};const Y=i({name:"MonitorManage",setup(){const{MonitorTable:t,MonitorTablePage:e,param:r,fetch:a,data:i,openAddForm:f,isDetectionAddMonitor:h}=(()=>{const t=s(),e=l(),{component:r,loading:a,param:i,data:y,total:f,fetch:h}=c({config:[{title:o("t_13_1745289354528"),key:"name",width:150},{title:o("t_17_1745227838561"),key:"site_domain",width:180,render:t=>n(u,{tag:"a",text:!0,type:"primary",href:`https://${t.site_domain}`,target:"_blank"},{default:()=>[t.site_domain]})},{title:o("t_14_1745289354902"),key:"cert_domain",width:180,render:t=>t.cert_domain||"-"},{title:o("t_15_1745289355714"),key:"ca",width:180},{title:o("t_16_1745289354902"),key:"state",width:100},{title:o("t_17_1745289355715"),key:"end_time",width:150,render:t=>t.end_time+"("+t.end_day+")"},{title:o("t_18_1745289354598"),key:"report_type",width:150,render:t=>n(z,{icon:t.report_type},null)},{title:o("t_4_1745215914951"),key:"active",width:100,render:t=>n(m,{value:1===t.active,onUpdateValue:()=>M(t)},null)},{title:o("t_19_1745289354676"),key:"update_time",width:150,render:t=>t.update_time||"-"},{title:o("t_7_1745215914189"),key:"create_time",width:150},{title:o("t_8_1745215914610"),key:"actions",width:150,fixed:"right",align:"right",render:t=>{let e,r;return n(p,{justify:"end"},{default:()=>[n(u,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>w(t)},H(e=o("t_11_1745215915429"))?e:{default:()=>[e]}),n(u,{size:"tiny",strong:!0,secondary:!0,type:"error",onClick:()=>x(t)},H(r=o("t_12_1745215914312"))?r:{default:()=>[r]})]})}}],request:L,defaultValue:{p:1,limit:10,search:""},watchValue:["p","limit"]}),{component:g}=d({param:i,total:f,alias:{page:"p",pageSize:"limit"}}),v=()=>{_({title:o("t_11_1745289354516"),area:500,component:V,footer:!0,onUpdateShow(t){t||h()}})},w=t=>{_({title:o("t_20_1745289354598"),area:500,component:V,componentProps:{isEdit:t.id,data:t},footer:!0,onUpdateShow(t){t||h()}})},x=t=>{E({title:o("t_0_1745294710530"),content:o("t_22_1745289359036"),confirmText:o("t_5_1744870862719"),cancelText:o("t_4_1744870861589"),onPositiveClick:async()=>{await D(t),h()}})},M=async t=>{await G({id:t.id,active:Number(t.active)?0:1}),h()};return{loading:a,fetch:h,MonitorTable:r,MonitorTablePage:g,isDetectionAddMonitor:()=>{const{type:r}=t.query;(null==r?void 0:r.includes("create"))&&(v(),e.push({query:{}}))},param:i,data:y,openAddForm:v}})(),g=M(["contentPadding","borderColor","headerHeight","iconColorHover"]);return w((()=>{a(),h()})),()=>n("div",{class:"h-full flex flex-col",style:g.value},[n("div",{class:"mx-auto max-w-[1600px] w-full p-6"},[n(A,null,{headerLeft:()=>{let t;return n(u,{type:"primary",size:"large",class:"px-5",onClick:f},"function"==typeof(e=t=o("t_11_1745289354516"))||"[object Object]"===Object.prototype.toString.call(e)&&!y(e)?t:{default:()=>[t]});var e},headerRight:()=>n(j,{value:r.value.search,"onUpdate:value":t=>r.value.search=t,onKeydown:t=>{"Enter"===t.key&&a()},onClear:()=>a(),placeholder:o("t_12_1745289356974"),clearable:!0,size:"large",class:"min-w-[300px]"},{suffix:()=>n("div",{class:"flex items-center",onClick:a},[n(N,{class:"text-[var(--text-color-3)] w-[1.6rem] cursor-pointer font-bold"},null)])}),content:()=>n("div",{class:"rounded-lg"},[n(t,{size:"medium"},{empty:()=>n(I,{addButtonText:o("t_11_1745289354516"),onAddClick:f},null)})]),footerRight:()=>n("div",{class:"mt-4 flex justify-end"},[n(e,null,{prefix:()=>n("span",null,[o("t_15_1745227839354"),b(" "),i.value.total,b(" "),o("t_16_1745227838930")])})])})])])}});export{Y as default};
