import{e as t,s as e,r as a,f as r,$ as o,d as i,c as n,a4 as s,u as l,g as c,h as d,B as u,a5 as m,j as p,k as _,i as y,l as f,m as h,y as g,z as v,o as w,aV as x,a as M,b,t as j}from"./main-l9ONqWM3.js";import{c as k,u as F,a as E,b as C}from"./index-CROykHUI.js";import{b as q}from"./business-BHURL4si.js";import{N as S}from"./index-DSYVB6Fx.js";import{T}from"./index-C6GLd94Y.js";import{B as z}from"./index-DoEhNl1p.js";import{E as A,S as P}from"./index-Boi7lFs7.js";import"./index-DBGpolyE.js";import"./useStore-DC43mr9k.js";import"./index-BrWkGMgD.js";import"./index-DDUoCc5m.js";import"./setting-CpZ_L6Bz.js";import"./access-DAUICydO.js";import"./data-DuVKJAVf.js";const{handleError:N}=F(),O=r(),U=t("monitor-store",(()=>{const t=a({id:0,name:"",domain:"",cycle:1,report_type:""}),e=async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/add_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return N(e)&&O.error(o("t_7_1745289355714")),!1}},r=async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/upd_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return N(e)&&O.error(o("t_23_1745289355716")),!1}};return{monitorForm:t,fetchMonitorList:async t=>{try{const{data:e,count:a}=await(t=>k("/v1/siteMonitor/get_list",t))(t).fetch();return{list:e||[],total:a}}catch(e){return N(e),{list:[],total:0}}},addNewMonitor:e,updateExistingMonitor:r,deleteExistingMonitor:async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/del_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return N(e)&&O.error(o("t_40_1745227838872")),!1}},setMonitorStatus:async t=>{try{const{fetch:e,message:a}=(t=>k("/v1/siteMonitor/set_site_monitor",t))(t);return a.value=!0,await e(),!0}catch(e){return N(e)&&O.error(o("t_24_1745289355715")),!1}},resetMonitorForm:()=>{t.value={id:0,name:"",domain:"",cycle:1,report_type:""}},updateMonitorForm:(e=t.value)=>{const{id:a,name:r,domain:o,cycle:i,report_type:n}=e||t.value;t.value={id:a,name:r,domain:o,cycle:i,report_type:n}},submitForm:async()=>{const{id:a,...o}=t.value;return a?r({id:a,...o}):e(o)}}})),V=i({name:"MonitorForm",props:{isEdit:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},setup(t){const{component:e}=Q(t.data);return()=>n(e,{labelPlacement:"top"},null)}});function B(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!y(t)}const{fetchMonitorList:L,deleteExistingMonitor:H,setMonitorStatus:D,monitorForm:I,addNewMonitor:R,updateExistingMonitor:$,resetMonitorForm:G,updateMonitorForm:K}=(()=>{const t=U();return{...t,...e(t)}})(),{handleError:J}=F(),Q=(t=null)=>{const{useFormInput:e,useFormCustom:a,useFormInputNumber:r}=h(),{open:o,close:i}=C({text:"正在提交信息，请稍后..."}),{confirm:s}=v(),l=f((()=>[e("名称","name"),e("域名","domain"),r("周期(分钟)","cycle",{class:"w-full"}),a((()=>n(S,{path:"report_type",isAddMode:!0,value:I.value.report_type,valueType:"type","onUpdate:value":t=>{I.value.report_type=t.value}},null)))])),c={name:{required:!0,message:"请输入名称",trigger:"input"},domain:{required:!0,message:"请输入正确的域名",trigger:"input",validator:(t,e,a)=>{q(e)?a():a(new Error("请输入正确的域名"))}},cycle:{required:!0,message:"请输入周期",trigger:"input",type:"number",min:1,max:365},report_type:{required:!0,message:"请选择消息通知类型",trigger:"change"}},{component:d,fetch:u}=g({config:l,defaultValue:I,request:async e=>{try{if(t)await $({...e,id:t.id});else{const{id:t,...a}=e;await R(a)}}catch(a){J(a).default("添加失败")}},rules:c});return s((async t=>{try{o(),await u(),t()}catch(e){return J(e)}finally{i()}})),w((()=>{K(t)})),x(G),{component:d}};const W=i({name:"MonitorManage",setup(){const{MonitorTable:t,MonitorTablePage:e,param:a,fetch:r,data:i,openAddForm:f,isDetectionAddMonitor:h}=(()=>{const t=s(),e=l(),{component:a,loading:r,param:i,data:y,total:f,fetch:h}=c({config:[{title:o("t_13_1745289354528"),key:"name",width:150},{title:o("t_17_1745227838561"),key:"site_domain",width:180,render:t=>n(u,{tag:"a",text:!0,type:"primary",href:`https://${t.site_domain}`,target:"_blank"},{default:()=>[t.site_domain]})},{title:o("t_14_1745289354902"),key:"cert_domain",width:180,render:t=>t.cert_domain||"-"},{title:o("t_15_1745289355714"),key:"ca",width:180},{title:o("t_16_1745289354902"),key:"state",width:100},{title:o("t_17_1745289355715"),key:"end_time",width:150,render:t=>t.end_time+"("+t.end_day+")"},{title:o("t_18_1745289354598"),key:"report_type",width:150,render:t=>n(T,{icon:t.report_type},null)},{title:o("t_4_1745215914951"),key:"active",width:100,render:t=>n(m,{value:1===t.active,onUpdateValue:()=>M(t)},null)},{title:o("t_19_1745289354676"),key:"update_time",width:150,render:t=>t.update_time||"-"},{title:o("t_7_1745215914189"),key:"create_time",width:150},{title:o("t_8_1745215914610"),key:"actions",width:150,fixed:"right",align:"right",render:t=>{let e,a;return n(p,{justify:"end"},{default:()=>[n(u,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>w(t)},B(e=o("t_11_1745215915429"))?e:{default:()=>[e]}),n(u,{size:"tiny",strong:!0,secondary:!0,type:"error",onClick:()=>x(t)},B(a=o("t_12_1745215914312"))?a:{default:()=>[a]})]})}}],request:L,defaultValue:{p:1,limit:10,search:""},watchValue:["p","limit"]}),{component:g}=d({param:i,total:f,alias:{page:"p",pageSize:"limit"}}),v=()=>{_({title:o("t_11_1745289354516"),area:500,component:V,footer:!0,onUpdateShow(t){t||h()}})},w=t=>{_({title:o("t_20_1745289354598"),area:500,component:V,componentProps:{isEdit:t.id,data:t},footer:!0,onUpdateShow(t){t||h()}})},x=t=>{E({title:o("t_0_1745294710530"),content:o("t_22_1745289359036"),confirmText:o("t_5_1744870862719"),cancelText:o("t_4_1744870861589"),onPositiveClick:async()=>{await H(t),h()}})},M=async t=>{await D({id:t.id,active:Number(t.active)?0:1}),h()};return{loading:r,fetch:h,MonitorTable:a,MonitorTablePage:g,isDetectionAddMonitor:()=>{const{type:a}=t.query;(null==a?void 0:a.includes("create"))&&(v(),e.push({query:{}}))},param:i,data:y,openAddForm:v}})(),g=M(["contentPadding","borderColor","headerHeight","iconColorHover"]);return w((()=>{r(),h()})),()=>n("div",{class:"h-full flex flex-col",style:g.value},[n("div",{class:"mx-auto max-w-[1600px] w-full p-6"},[n(z,null,{headerLeft:()=>{let t;return n(u,{type:"primary",size:"large",class:"px-5",onClick:f},"function"==typeof(e=t=o("t_11_1745289354516"))||"[object Object]"===Object.prototype.toString.call(e)&&!y(e)?t:{default:()=>[t]});var e},headerRight:()=>n(j,{value:a.value.search,"onUpdate:value":t=>a.value.search=t,onKeydown:t=>{"Enter"===t.key&&r()},onClear:()=>r(),placeholder:o("t_12_1745289356974"),clearable:!0,size:"large",class:"min-w-[300px]"},{suffix:()=>n("div",{class:"flex items-center",onClick:r},[n(P,{class:"text-[var(--text-color-3)] w-[1.6rem] cursor-pointer font-bold"},null)])}),content:()=>n("div",{class:"rounded-lg"},[n(t,{size:"medium"},{empty:()=>n(A,{addButtonText:o("t_11_1745289354516"),onAddClick:f},null)})]),footerRight:()=>n("div",{class:"mt-4 flex justify-end"},[n(e,null,{prefix:()=>n("span",null,[o("t_15_1745227839354"),b(" "),i.value.total,b(" "),o("t_16_1745227838930")])})])})])])}});export{W as default};
