import{e as t,s as e,r,f as o,$ as n,d as a,c as i,a4 as s,u as l,g as d,B as c,a5 as u,h as m,j as p,i as _,k as y,l as h,y as f,z as g,o as v,aD as w,a as x}from"./main-DzwaUoFb.js";import{u as M,E as j}from"./index-CgB92oEK.js";import{c as k,u as b,a as C,b as F}from"./index-BNb4DSrN.js";import{d as S,T as P,H as E}from"./business-Ckv_hx4t.js";import{N as q}from"./index-D-9f_RTw.js";import{T}from"./index-DeqXP45Z.js";import{B as z}from"./index-B9Dyybyi.js";import"./index-Dhf2Wig3.js";import"./useStore-C7yqmA9q.js";import"./index-QkiriD3I.js";import"./index-sgsDdEi4.js";import"./setting-BDH9NQKu.js";import"./access-D1d2FuYi.js";import"./data-BqkycWmp.js";const{handleError:A}=b(),I=o(),N=t("monitor-store",(()=>{const t=r({id:0,name:"",domain:"",cycle:1,report_type:""}),e=async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/add_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return A(e)&&I.error(n("t_7_1745289355714")),!1}},o=async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/upd_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return A(e)&&I.error(n("t_23_1745289355716")),!1}};return{monitorForm:t,fetchMonitorList:async t=>{try{const{data:e,count:r}=await(t=>k("/v1/siteMonitor/get_list",t))(t).fetch();return{list:e||[],total:r}}catch(e){return A(e),{list:[],total:0}}},addNewMonitor:e,updateExistingMonitor:o,deleteExistingMonitor:async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/del_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return A(e)&&I.error(n("t_40_1745227838872")),!1}},setMonitorStatus:async t=>{try{const{fetch:e,message:r}=(t=>k("/v1/siteMonitor/set_site_monitor",t))(t);return r.value=!0,await e(),!0}catch(e){return A(e)&&I.error(n("t_24_1745289355715")),!1}},resetMonitorForm:()=>{t.value={id:0,name:"",domain:"",cycle:1,report_type:""}},updateMonitorForm:(e=t.value)=>{const{id:r,name:o,domain:n,cycle:a,report_type:i}=e||t.value;t.value={id:r,name:o,domain:n,cycle:a,report_type:i}},submitForm:async()=>{const{id:r,...n}=t.value;return r?o({id:r,...n}):e(n)}}})),O=a({name:"MonitorForm",props:{isEdit:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},setup(t){const{component:e}=K(t.data);return()=>i(e,{labelPlacement:"top"},null)}});function B(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!_(t)}const{fetchMonitorList:U,deleteExistingMonitor:V,setMonitorStatus:D,monitorForm:H,addNewMonitor:L,updateExistingMonitor:R,resetMonitorForm:$,updateMonitorForm:G}=(()=>{const t=N();return{...t,...e(t)}})(),{handleError:J}=b(),K=(t=null)=>{const{useFormInput:e,useFormCustom:r,useFormInputNumber:o}=h(),{open:n,close:a}=F({text:"正在提交信息，请稍后..."}),{confirm:s}=g(),l=y((()=>[e("名称","name"),e("域名/IP地址","domain"),o("周期(分钟)","cycle",{class:"w-full"}),r((()=>i(q,{path:"report_type",isAddMode:!0,value:H.value.report_type,valueType:"type","onUpdate:value":t=>{H.value.report_type=t.value}},null)))])),d={name:{required:!0,message:"请输入名称",trigger:"input"},domain:{required:!0,message:"请输入正确的域名或IP地址",trigger:"input",validator:(t,e,r)=>{(t=>{if(!t)return!1;const e=t.split(":");if(1===e.length)return S(t)||P(t);if(2===e.length){const[t,r]=e;return!(!t||!r)&&(S(t)||P(t))&&E(r)}return!1})(e)?r():r(new Error("请输入正确的域名或IP地址（支持域名:端口或IP:端口格式）"))}},cycle:{required:!0,message:"请输入周期",trigger:"input",type:"number",min:1,max:365},report_type:{required:!0,message:"请选择消息通知类型",trigger:"change"}},{component:c,fetch:u}=f({config:l,defaultValue:H,request:async e=>{try{if(t)await R({...e,id:t.id});else{const{id:t,...r}=e;await L(r)}}catch(r){J(r).default("添加失败")}},rules:d});return s((async t=>{try{n(),await u(),t()}catch(e){return J(e)}finally{a()}})),v((()=>{G(t)})),w($),{component:c}};const Q=a({name:"MonitorManage",setup(){const{TableComponent:t,PageComponent:e,SearchComponent:r,fetch:o,openAddForm:a,isDetectionAddMonitor:y}=(()=>{const t=s(),e=l(),{TableComponent:r,PageComponent:o,loading:a,param:_,fetch:y}=d({config:[{title:n("t_13_1745289354528"),key:"name",width:150},{title:n("t_17_1745227838561"),key:"site_domain",width:180,render:t=>i(c,{tag:"a",text:!0,type:"primary",href:`https://${t.site_domain}`,target:"_blank"},{default:()=>[t.site_domain]})},{title:n("t_14_1745289354902"),key:"cert_domain",width:180,render:t=>t.cert_domain||"-"},{title:n("t_15_1745289355714"),key:"ca",width:180},{title:n("t_16_1745289354902"),key:"state",width:100},{title:n("t_17_1745289355715"),key:"end_time",width:150,render:t=>t.end_time+"("+t.end_day+")"},{title:n("t_2_1750399515511"),key:"except_end_time",width:150,render:t=>t.except_end_time||"-"},{title:n("t_19_1745289354676"),key:"last_time",width:150,render:t=>t.last_time||"-"},{title:n("t_0_1745295228865"),key:"update_time",width:150,render:t=>t.update_time||"-"},{title:n("t_18_1745289354598"),key:"report_type",width:150,render:t=>i(T,{icon:t.report_type},null)},{title:n("t_4_1745215914951"),key:"active",width:100,render:t=>i(u,{value:1===t.active,onUpdateValue:()=>w(t)},null)},{title:n("t_7_1745215914189"),key:"create_time",width:150},{title:n("t_8_1745215914610"),key:"actions",width:150,fixed:"right",align:"right",render:t=>{let e,r;return i(m,{justify:"end"},{default:()=>[i(c,{size:"tiny",strong:!0,secondary:!0,type:"primary",onClick:()=>g(t)},B(e=n("t_11_1745215915429"))?e:{default:()=>[e]}),i(c,{size:"tiny",strong:!0,secondary:!0,type:"error",onClick:()=>v(t)},B(r=n("t_12_1745215914312"))?r:{default:()=>[r]})]})}}],request:U,defaultValue:{p:1,limit:10,search:""},alias:{page:"p",pageSize:"limit"},watchValue:["p","limit"],storage:"monitorPageSize"}),{SearchComponent:h}=M({onSearch:t=>{_.value.search=t,y()}}),f=()=>{p({title:n("t_11_1745289354516"),area:500,component:O,footer:!0,onUpdateShow(t){t||y()}})},g=t=>{p({title:n("t_20_1745289354598"),area:500,component:O,componentProps:{isEdit:t.id,data:t},footer:!0,onUpdateShow(t){t||y()}})},v=t=>{C({title:n("t_0_1745294710530"),content:n("t_22_1745289359036"),confirmText:n("t_5_1744870862719"),cancelText:n("t_4_1744870861589"),onPositiveClick:async()=>{await V(t),y()}})},w=async t=>{await D({id:t.id,active:Number(t.active)?0:1}),y()};return{loading:a,fetch:y,TableComponent:r,PageComponent:o,SearchComponent:h,isDetectionAddMonitor:()=>{const{type:r}=t.query;(null==r?void 0:r.includes("create"))&&(f(),e.push({query:{}}))},openAddForm:f}})(),h=x(["contentPadding","borderColor","headerHeight","iconColorHover"]);return v((()=>{o(),y()})),()=>i("div",{class:"h-full flex flex-col",style:h.value},[i("div",{class:"mx-auto max-w-[1600px] w-full p-6"},[i(z,null,{headerLeft:()=>{let t;return i(c,{type:"primary",size:"large",class:"px-5",onClick:a},"function"==typeof(e=t=n("t_11_1745289354516"))||"[object Object]"===Object.prototype.toString.call(e)&&!_(e)?t:{default:()=>[t]});var e},headerRight:()=>i(r,{placeholder:n("t_12_1745289356974")},null),content:()=>i("div",{class:"rounded-lg"},[i(t,{size:"medium","scroll-x":"1800"},{empty:()=>i(j,{addButtonText:n("t_11_1745289354516"),onAddClick:a},null)})]),footerRight:()=>i("div",{class:"mt-4 flex justify-end"},[i(e,null,null)])})])])}});export{Q as default};
